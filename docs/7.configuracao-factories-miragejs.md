# 7. Configuração de Factories no MirageJS para `createList`

Este tutorial descreve como configurar factories no MirageJS para gerar dados de forma dinâmica e eficiente usando o método `server.createList`, resolvendo o problema de dados ausentes ao tentar criar múltiplas entidades.

## Problema

Ao tentar gerar múltiplas instâncias de um modelo no MirageJS usando `server.createList("company", 10)`, a operação falhava ou não gerava os dados esperados, resultando em um erro como "Mirage: Your app tried to POST '/companies', but there was no route defined..." ou simplesmente uma lista vazia de empresas.

A causa raiz é que `server.createList` não sabe como "inventar" os atributos para cada nova instância do modelo (`name`, `cnpj`, `email` para uma `company`) sem uma "receita" ou "molde" de dados. Este molde é fornecido por uma **Factory**.

## Solução: Implementação de Factories com Faker.js

A solução envolveu a criação de uma Factory para o modelo `company`, que instrui o MirageJS sobre como gerar cada atributo, e a integração com a biblioteca `faker-js` para produzir dados realistas.

### Passo 1: Instalação do `faker-js`

O `faker-js` é uma biblioteca excelente para gerar dados falsos (nomes, e-mails, endereços, etc.), tornando os dados gerados pelo Mirage mais realistas e úteis para testes e desenvolvimento.

```bash
npm install --save-dev @faker-js/faker
```

### Passo 2: Criação da `companyFactory`

Uma Factory foi criada para o modelo `company` no arquivo `src/mirage/factories/company.ts`. Esta factory define como cada atributo de uma empresa deve ser gerado.

```typescript
// src/mirage/factories/company.ts
import { Factory } from 'miragejs';
import { faker } from '@faker-js/faker';

// Função auxiliar para gerar um CNPJ no formato XX.XXX.XXX/0001-XX
const generateCnpj = () => {
  const n = () => Math.floor(Math.random() * 10);
  return `${n()}${n()}.${n()}${n()}${n()}.${n()}${n()}${n()}/0001-${n()}${n()}`;
};

export default Factory.extend({
  name() {
    return faker.company.name();
  },
  cnpj() {
    return generateCnpj();
  },
  email() {
    return faker.internet.email().toLowerCase();
  },
});
```

### Passo 3: Registro da Factory

A `companyFactory` precisa ser registrada no MirageJS para que ele saiba onde encontrá-la e como usá-la. Isso foi feito no arquivo `src/mirage/factories/index.ts`.

```typescript
// src/mirage/factories/index.ts
import companyFactory from "./company";

export default {
  company: companyFactory,
};
```

### Passo 4: Atualização do `seeds`

Com a factory definida e registrada, o arquivo `src/mirage/seeds/index.ts` foi atualizado para utilizar o método `server.createList`, que agora pode gerar múltiplas empresas automaticamente, aproveitando a lógica definida na `companyFactory`.

```typescript
// src/mirage/seeds/index.ts
import { Server } from "miragejs";
import type { AppRegistry } from "../types";

export default function (server: Server<AppRegistry>) {
  server.createList("company", 10);
}
```

## Benefícios

-   **Geração Dinâmica de Dados:** Facilita a criação de grandes volumes de dados de teste de forma rápida e com conteúdo realista.
-   **Reusabilidade:** A lógica de geração de dados para um modelo é encapsulada na factory, podendo ser reutilizada em diferentes partes do Mirage (seeds, rotas, testes).
-   **Manutenção Simplificada:** Alterações na estrutura do modelo ou na lógica de geração de dados são centralizadas na factory.
-   **Testes Mais Abrangentes:** Permite testar cenários com diferentes quantidades e variações de dados de forma eficaz.

Esta configuração permite que `server.createList` funcione conforme o esperado, fornecendo um conjunto robusto de dados fictícios para o desenvolvimento e teste da aplicação.