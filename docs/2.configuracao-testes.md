# Configuração de Testes com Vitest e React Testing Library

Este tutorial documenta o processo de configuração do ambiente de testes para um projeto React com Vite, utilizando Vitest como test runner e React Testing Library para renderização e interação com componentes.

## 1. Ferramentas Utilizadas

- **Vite:** Build tool que oferece um ambiente de desenvolvimento rápido.
- **React:** Biblioteca para construção de interfaces de usuário.
- **Vitest:** Um test runner rápido e moderno, com compatibilidade nativa com Vite.
- **React Testing Library:** Utilitários para testar componentes React de forma que se assemelhe a como o usuário final os utiliza.
- **jsdom:** Uma implementação em JavaScript de padrões web, usada para simular o ambiente de um navegador no Node.js.
- **`@testing-library/jest-dom`:** Matchers customizados para o Jest (e compatíveis com Vitest) para facilitar asserções em nós do DOM.

## 2. Instalação das Dependências

O primeiro passo foi instalar todas as dependências de desenvolvimento necessárias. Isso foi feito com o seguinte comando:

```bash
npm install -D vitest jsdom @testing-library/react @testing-library/user-event @testing-library/jest-dom
```

## 3. Configuração do Vite (`vite.config.ts`)

Para que o Vite reconhecesse o ambiente de testes, o arquivo `vite.config.ts` foi modificado.

Primeiramente, a importação do `defineConfig` foi alterada para `vitest/config` para garantir que o TypeScript reconhecesse as tipagens específicas do Vitest:

```typescript
// vite.config.ts
import { defineConfig } from 'vitest/config'
// ...
```

Em seguida, a propriedade `test` foi adicionada ao objeto de configuração:

```typescript
// vite.config.ts
export default defineConfig({
  // ... outras configurações
  test: {
    globals: true, // Permite o uso de globais do Vitest (vi, describe, it, expect) sem importação explícita
    environment: 'jsdom', // Simula o ambiente de um navegador
    setupFiles: './src/setupTests.ts', // Arquivo de setup a ser executado antes de cada teste
  },
})
```

## 4. Arquivo de Setup (`src/setupTests.ts`)

Foi criado um arquivo `src/setupTests.ts` para estender os matchers do Vitest com os do `jest-dom`, facilitando a escrita de asserções mais declarativas como `.toBeInTheDocument()`.

O conteúdo do arquivo é simples:

```typescript
// src/setupTests.ts
import '@testing-library/jest-dom/vitest';
```

## 5. Configuração do TypeScript (`tsconfig.json` e `tsconfig.app.json`)

Para que o TypeScript e o VSCode reconhecessem as globais do Vitest (como `vi` e `describe`), foi necessário atualizar os arquivos de configuração do TypeScript.

A propriedade `types` foi adicionada ao `compilerOptions` no arquivo `tsconfig.app.json`:

```json
// tsconfig.app.json
{
  "compilerOptions": {
    // ...
    "types": ["vite/client", "vitest/globals"]
  },
  // ...
}
```

## 6. Adição do Script de Teste (`package.json`)

Para facilitar a execução dos testes, um novo script foi adicionado à seção `scripts` do `package.json`:

```json
// package.json
"scripts": {
  // ...
  "test": "vitest"
},
```

## 7. Escrevendo o Primeiro Teste

Com a configuração pronta, um primeiro arquivo de teste foi criado para o componente `CompanyRegistration` em `src/pages/Company/Register/index.test.tsx`.

O teste verifica se os principais elementos do formulário são renderizados corretamente.

```tsx
// src/pages/Company/Register/index.test.tsx
import { render, screen } from '@testing-library/react';
import { BrowserRouter } from 'react-router-dom';
import { describe, it, expect } from 'vitest';
import CompanyRegistration from './index';

// Mock do hook para isolar o componente
vi.mock('@/hooks/useRegisterCompany', () => ({
  useRegisterCompany: () => ({
    submitCompany: vi.fn(),
    isLoading: false,
    error: null,
    isSuccess: false,
  }),
}));

describe('CompanyRegistration', () => {
  it('should render the registration form', () => {
    render(
      <BrowserRouter>
        <CompanyRegistration />
      </BrowserRouter>
    );

    expect(screen.getByRole('heading', { name: /cadastro de empresa/i })).toBeInTheDocument();
    expect(screen.getByLabelText(/nome da empresa/i)).toBeInTheDocument();
    expect(screen.getByLabelText(/cnpj/i)).toBeInTheDocument();
    expect(screen.getByLabelText(/e-mail/i)).toBeInTheDocument();
    expect(screen.getByRole('button', { name: /cadastrar/i })).toBeInTheDocument();
  });
});
```

## 8. Executando os Testes

Para rodar a suíte de testes, basta executar o comando no terminal:

```bash
npm test
```
